---
title: Service クラス
description:
category: php
createdAt: 2025-04-28
updatedAt: 2025-04-28
sortNumber: 102
path: "/documents/ghostphp/102_Service"
---

# Service クラス

`Service` クラスは、セッションの管理、CSRFトークンの生成と検証、およびテンプレートのレンダリングを行うためのユーティリティクラスです。Webアプリケーションで一般的に必要となる操作を簡単に実行できるようにします。

## 機能概要

### 1. CSRFトークンの生成
このクラスは、フォームに関連付けられたCSRF（クロスサイトリクエストフォージェリ）トークンを生成し、セッションに保存します。これにより、フォームの送信時にセキュリティを強化できます。

- **メソッド**: `setToken(string $form_name): string`
  - **説明**: 指定したフォーム名に基づいて新しいCSRFトークンを生成します。
  - **引数**: 
    - `$form_name`: トークンを生成するフォームの名前（文字列）
  - **返り値**: 生成されたCSRFトークン（文字列）

### 2. CSRFトークンの検証
送信されたフォームのCSRFトークンが有効であるかどうかを確認するためのメソッドです。このチェックにより、不正なリクエストからアプリケーションを保護します。

- **メソッド**: `checkToken(string $form_name): bool`
  - **説明**: 指定したフォームのCSRFトークンがセッションに保存されたものと一致するかどうかを確認します。
  - **引数**:
    - `$form_name`: トークンを検証するフォームの名前（文字列）
  - **返り値**: トークンが一致すれば`true`、一致しなければ`false`

### 3. テンプレートのレンダリング
指定されたテンプレートをレンダリングするためのメソッドです。テンプレートエンジンを使って、HTMLを生成します。

- **メソッド**: `render(): mixed`
  - **説明**: テンプレートをレンダリングしてその結果を返します。
  - **返り値**: レンダリングされたテンプレートの出力（型は実装に依存）

## コンストラクタ
- **メソッド**: `__construct()`
  - **説明**: `Service` クラスのインスタンスを生成します。`Session` クラスのインスタンスを作成し、セッションの管理を行います。

## 利用例

### CSRFトークンの生成と検証

```php
$service = new Service();

// CSRFトークンを生成
$form_name = "login_form";
$csrf_token = $service->setToken($form_name);

// フォーム送信時にトークンを検証
if ($service->checkToken($form_name)) {
    // トークンが一致する場合の処理
    echo "CSRFトークンが有効です";
} else {
    // トークンが一致しない場合の処理
    echo "CSRFトークンが無効です";
}
